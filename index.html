<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>XO Game - Single Page</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://cdn.jsdelivr.net/npm/canvas-confetti@1.9.3/dist/confetti.browser.min.js"></script>
    <style>
        @keyframes xDraw {
            0% { clip-path: inset(0 0 100% 0); }
            50% { clip-path: inset(0 0 0 0); }
            100% { clip-path: inset(0 0 0 0); }
        }
        @keyframes oDraw {
            0% { clip-path: inset(100% 0 0 0); }
            50% { clip-path: inset(0 0 0 0); }
            100% { clip-path: inset(0 0 0 0); }
        }
        @keyframes winPulse {
            0%, 100% { transform: scale(1); }
            50% { transform: scale(1.2); }
        }
        @keyframes bounce {
            0%, 20%, 53%, 80%, 100% { transform: translate3d(0,0,0); }
            40%, 43% { transform: translate3d(0,-10px,0); }
            70% { transform: translate3d(0,-5px,0); }
            90% { transform: translate3d(0,-2px,0); }
        }
        .x-symbol { color: #ef4444; font-size: 4.5rem; font-weight: bold; animation: xDraw 0.6s ease-in-out; }
        .o-symbol { color: white; font-size: 4.5rem; font-weight: bold; animation: oDraw 0.6s ease-in-out; }
        .board { max-width: 550px; height: 550px; }
        .cell { height: calc(33.33% - 5px); border: 4px solid #333; transition: background 0.3s; }
        .cell:hover { background: rgba(255,255,255,0.1); }
        .winner-line { background: linear-gradient(90deg, #ffd700, #ff6b6b); animation: winPulse 1s infinite; }
        .player-active { animation: bounce 1s infinite; }
        .timer-warning { color: #ef4444; font-weight: bold; animation: bounce 0.5s infinite; }
        .first-move-btn { width: 220px; height: 70px; font-size: 1.4rem; }
        .start-restart-btn { width: 250px; height: 65px; font-size: 1.3rem; }
        .name-input { width: 180px; height: 45px; font-size: 1.1rem; }
        .first-selected { background: #10b981 !important; box-shadow: 0 0 20px #10b981; }
    </style>
</head>
<body class="bg-gradient-to-br from-purple-900 via-blue-900 to-indigo-900 min-h-screen flex flex-col items-center justify-center p-6 text-white">
    <audio id="tapSound" preload="auto">
        <source src="data:audio/wav;base64,UklGRnoGAABXQVZFZm10IBAAAAABAAEAQB8AAEAfAAABAAgAZGF0YQoGAACBhYqFbF1fdJivrJBhNjVgodDbq2EcBj+a2/LDciUFLIHO8tiJNwgZaLvt559NEAxQp+PwtmMcBjiR1/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBqS0/LMeSwFJHfH8N2QQAoUXrTp66hVFApGn+DyvmwhBqS0/" type="audio/wav">
    </audio>

    <!-- SINGLE PAGE - All Elements Always Visible -->
    <div class="w-full max-w-6xl mb-8">
        <!-- Player Names and Timers (Top Bar) -->
        <div class="flex justify-between items-center mb-6">
            <div id="player1-info" class="text-left">
                <input type="text" id="player1-name-input" class="name-input bg-gray-700 rounded-lg px-3 text-center font-bold mb-2" placeholder="Player 1" maxlength="10" value="Rahul">
                <div id="player1-timer" class="text-xl font-mono">00:10</div>
            </div>
            <div id="player2-info" class="text-right">
                <input type="text" id="player2-name-input" class="name-input bg-gray-700 rounded-lg px-3 text-center font-bold mb-2" placeholder="Player 2" maxlength="10" value="Priya">
                <div id="player2-timer" class="text-xl font-mono">00:10</div>
            </div>
        </div>

        <!-- Status and Controls Row -->
        <div class="flex flex-col lg:flex-row justify-between items-center mb-8 gap-4">
            <div id="status" class="text-3xl font-bold text-center lg:text-left flex-1">Enter names and choose first player!</div>
            
            <div class="flex flex-wrap gap-3 justify-center lg:justify-end">
                <!-- First Move Selection -->
                <button id="player1-first" class="first-move-btn bg-red-500 hover:bg-red-600 rounded-xl shadow-xl font-bold">Player 1 First</button>
                <button id="player2-first" class="first-move-btn bg-blue-500 hover:bg-blue-600 rounded-xl shadow-xl font-bold">Player 2 First</button>
                
                <!-- Game Controls -->
                <button id="start-game" class="start-restart-btn bg-green-500 hover:bg-green-600 rounded-xl shadow-xl font-bold hidden">Start Game</button>
                <button id="restart-game" class="start-restart-btn bg-red-500 hover:bg-red-600 rounded-xl shadow-xl font-bold hidden">Restart</button>
            </div>
        </div>
    </div>

    <!-- Game Board -->
    <div id="game-board" class="board grid grid-cols-3 gap-2 mb-12 bg-gray-800 p-10 rounded-3xl shadow-3xl">
        <div class="cell flex items-center justify-center cursor-pointer bg-gray-700 rounded-xl hover:shadow-lg" data-index="0"></div>
        <div class="cell flex items-center justify-center cursor-pointer bg-gray-700 rounded-xl hover:shadow-lg" data-index="1"></div>
        <div class="cell flex items-center justify-center cursor-pointer bg-gray-700 rounded-xl hover:shadow-lg" data-index="2"></div>
        <div class="cell flex items-center justify-center cursor-pointer bg-gray-700 rounded-xl hover:shadow-lg" data-index="3"></div>
        <div class="cell flex items-center justify-center cursor-pointer bg-gray-700 rounded-xl hover:shadow-lg" data-index="4"></div>
        <div class="cell flex items-center justify-center cursor-pointer bg-gray-700 rounded-xl hover:shadow-lg" data-index="5"></div>
        <div class="cell flex items-center justify-center cursor-pointer bg-gray-700 rounded-xl hover:shadow-lg" data-index="6"></div>
        <div class="cell flex items-center justify-center cursor-pointer bg-gray-700 rounded-xl hover:shadow-lg" data-index="7"></div>
        <div class="cell flex items-center justify-center cursor-pointer bg-gray-700 rounded-xl hover:shadow-lg" data-index="8"></div>
    </div>

    <script>
        class XOGame {
            constructor() {
                this.board = Array(9).fill(null);
                this.currentPlayer = null;
                this.firstPlayer = null;
                this.gameActive = false;
                this.moveNumber = 0;
                this.currentTimer = null;
                this.player1Name = 'Rahul';
                this.player2Name = 'Priya';
                this.xPositions = [];
                this.oPositions = [];
                this.init();
            }

            init() {
                this.cells = document.querySelectorAll('.cell');
                this.tapSound = document.getElementById('tapSound');
                this.statusEl = document.getElementById('status');
                
                // Name inputs
                const p1Input = document.getElementById('player1-name-input');
                const p2Input = document.getElementById('player2-name-input');
                p1Input.addEventListener('input', () => this.updatePlayerNames());
                p2Input.addEventListener('input', () => this.updatePlayerNames());
                
                // First move selection
                document.getElementById('player1-first').addEventListener('click', () => this.selectFirstPlayer(1));
                document.getElementById('player2-first').addEventListener('click', () => this.selectFirstPlayer(2));
                
                // Game controls
                document.getElementById('start-game').addEventListener('click', () => this.startGame());
                document.getElementById('restart-game').addEventListener('click', () => this.restart());

                this.cells.forEach(cell => cell.addEventListener('click', (e) => this.handleCellClick(e)));
                this.updatePlayerNames(); // Initial names
            }

            updatePlayerNames() {
                this.player1Name = document.getElementById('player1-name-input').value.trim() || 'Player 1';
                this.player2Name = document.getElementById('player2-name-input').value.trim() || 'Player 2';
            }

            playSound() {
                const audio = this.tapSound.cloneNode();
                audio.play().catch(() => {});
            }

            selectFirstPlayer(playerNum) {
                // Reset previous selection
                document.getElementById('player1-first').classList.remove('first-selected');
                document.getElementById('player2-first').classList.remove('first-selected');
                
                // Mark selected
                if (playerNum === 1) {
                    document.getElementById('player1-first').classList.add('first-selected');
                } else {
                    document.getElementById('player2-first').classList.add('first-selected');
                }
                
                this.firstPlayer = playerNum;
                this.currentPlayer = playerNum;
                document.getElementById('start-game').classList.remove('hidden');
                document.getElementById('restart-game').classList.remove('hidden');
                
                const playerName = playerNum === 1 ? this.player1Name : this.player2Name;
                this.statusEl.textContent = `${playerName} selected first! Click START GAME`;
            }

            startGame() {
                if (!this.firstPlayer) {
                    alert('Please choose who goes first!');
                    return;
                }
                
                this.gameActive = true;
                this.board = Array(9).fill(null);
                this.xPositions = [];
                this.oPositions = [];
                this.moveNumber = 0;
                this.updateBoard();
                this.nextTurn();
                this.statusEl.textContent = `${this.player1Name.charAt(0)}'s turn! (10 sec)`;
            }

            handleCellClick(e) {
                if (!this.gameActive || !this.currentPlayer) return;
                const index = parseInt(e.target.dataset.index);
                if (this.board[index]) return;

                const symbol = this.currentPlayer === 1 ? 'X' : 'O';
                this.board[index] = symbol;
                
                // 4th symbol removes the FIRST one
                if (symbol === 'X') {
                    this.xPositions.push(index);
                    if (this.xPositions.length > 3) {
                        const removeIndex = this.xPositions.shift();
                        this.board[removeIndex] = null;
                    }
                } else {
                    this.oPositions.push(index);
                    if (this.oPositions.length > 3) {
                        const removeIndex = this.oPositions.shift();
                        this.board[removeIndex] = null;
                    }
                }
                
                this.moveNumber++;
                this.playSound();
                this.updateBoard();
                
                const winner = this.checkWinner();
                if (winner) {
                    this.endGame(winner);
                } else if (!this.board.includes(null)) {
                    this.endGame('Draw');
                } else {
                    this.switchPlayer();
                }
            }

            updateBoard() {
                this.cells.forEach((cell, index) => {
                    cell.innerHTML = '';
                    if (this.board[index]) {
                        const symbol = document.createElement('div');
                        symbol.className = this.board[index] === 'X' ? 'x-symbol' : 'o-symbol';
                        symbol.textContent = this.board[index];
                        cell.appendChild(symbol);
                    }
                });
            }

            switchPlayer() {
                this.currentPlayer = 3 - this.currentPlayer;
                const currentName = this.currentPlayer === 1 ? this.player1Name : this.player2Name;
                this.nextTurn();
                this.statusEl.textContent = `${currentName.charAt(0)}'s turn! (10 sec)`;
            }

            nextTurn() {
                this.startTimer();
                document.getElementById('player1-info').classList.toggle('player-active', this.currentPlayer === 1);
                document.getElementById('player2-info').classList.toggle('player-active', this.currentPlayer === 2);
            }

            startTimer() {
                clearInterval(this.currentTimer);
                const timeLimit = 10000; // 10 seconds
                let timeLeft = timeLimit / 1000;
                const playerTimer = document.getElementById(`player${this.currentPlayer}-timer`);
                
                this.currentTimer = setInterval(() => {
                    timeLeft -= 0.1;
                    const secs = Math.floor(timeLeft);
                    playerTimer.textContent = `00:${secs.toString().padStart(2, '0')}`;
                    
                    if (timeLeft <= 3) {
                        playerTimer.classList.add('timer-warning');
                    }
                    
                    if (timeLeft <= 0) {
                        clearInterval(this.currentTimer);
                        const opponent = 3 - this.currentPlayer;
                        const opponentName = opponent === 1 ? this.player1Name : this.player2Name;
                        this.endGame(`${opponentName.charAt(0)} (${opponentName}) wins by timeout!`);
                    }
                }, 100);
            }

            checkWinner() {
                const winConditions = [
                    [0,1,2], [3,4,5], [6,7,8],
                    [0,3,6], [1,4,7], [2,5,8],
                    [0,4,8], [2,4,6]
                ];
                for (let condition of winConditions) {
                    const [a, b, c] = condition;
                    if (this.board[a] && this.board[a] === this.board[b] && this.board[a] === this.board[c]) {
                        condition.forEach(i => this.cells[i].classList.add('winner-line'));
                        return this.board[a];
                    }
                }
                return null;
            }

            endGame(winner) {
                this.gameActive = false;
                clearInterval(this.currentTimer);
                if (winner === 'Draw') {
                    this.statusEl.textContent = 'Game Draw! ðŸŽ®';
                } else if (typeof winner === 'string' && winner.includes('timeout')) {
                    this.statusEl.textContent = winner;
                    confetti({ particleCount: 100, spread: 70 });
                } else {
                    const playerNum = winner === 'X' ? 1 : 2;
                    const playerName = playerNum === 1 ? this.player1Name : this.player2Name;
                    this.statusEl.textContent = `${playerName.charAt(0)} (${playerName}) WINS! ðŸŽ‰`;
                    this.celebrateWin(playerNum);
                }
            }

            celebrateWin(playerNum) {
                confetti({
                    particleCount: 150,
                    spread: 70,
                    origin: { y: 0.6 }
                });
            }

            restart() {
                this.gameActive = false;
                clearInterval(this.currentTimer);
                this.board = Array(9).fill(null);
                this.xPositions = [];
                this.oPositions = [];
                this.moveNumber = 0;
                this.firstPlayer = null;
                this.currentPlayer = null;
                document.getElementById('player1-first').classList.remove('first-selected');
                document.getElementById('player2-first').classList.remove('first-selected');
                document.getElementById('start-game').classList.add('hidden');
                document.getElementById('restart-game').classList.add('hidden');
                this.updateBoard();
                document.querySelectorAll('.cell').forEach(cell => cell.classList.remove('winner-line'));
                document.getElementById('player1-info').classList.remove('player-active');
                document.getElementById('player2-info').classList.remove('player-active');
                document.getElementById('player1-timer').textContent = '00:10';
                document.getElementById('player2-timer').textContent = '00:10';
                this.statusEl.textContent = 'Game Reset! Enter names & choose first player';
            }
        }

        const game = new XOGame();
    </script>
</body>
</html>
